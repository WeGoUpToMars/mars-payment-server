<!DOCTYPE html>
<html lang="ko">
<head>
  <title>구매하기</title>
  <meta charset="utf-8"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>
<body>
<section>
  <h1>구매하기</h1>
  <h3>티셔츠</h3>
  <span id="price">10</span>원
  <br>
  <button id="toss-payment-button">TOSS PAY로 결제하기</button>
  <br>
  <button id="kakao-payment-button">KAKAO PAY로 결제하기</button>
</section>
<script src="https://js.tosspayments.com/v1"></script>
<script>
  const orderId = new Date().getTime();
  const price = parseInt(document.getElementById("price").textContent);
  tossPay(orderId);

  function tossPay(orderId) {
    const tossPayments = TossPayments("test_ck_ADpexMgkW36GJ10RlzdVGbR5ozO0");
    const tossPayButton = document.getElementById("toss-payment-button");

    tossPayButton.addEventListener("click", function () {
      const paymentData = {
        amount: price,
        orderId: orderId,
        orderName: "티셔츠",
        customerName: "이토페",
        successUrl: window.location.origin + "/mars/payments/toss/success",
        failUrl: window.location.origin + "/mars/payments/toss/fail",
      };

      tossPayments.requestPayment("카드", paymentData);
    });
  }
</script>
<script>
  const prepareRequest = {
    "cid": "TC0ONETIME",
    "partner_order_id": "mars-01",
    "partner_user_id": "user-01",
    "item_name": "책",
    "quantity": 1,
    "total_amount": 10000,
    "tax_free_amount": 10000,
    "approval_url": window.location.origin + "/mars/payments/kakao/success",
    "cancel_url": window.location.origin + "/mars/payments/kakao/cancel",
    "fail_url": window.location.origin + "/mars/payments/kakao/fail"
  };

  kakaoPay();

  function kakaoPay() {
    $('#kakao-payment-button').click(
            function () {
              $.ajax({
                url: "http://localhost:18189/mars/payments/kakao/prepare",
                method: "post",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(prepareRequest),
                success: function (response) {
                  alert(response);
                },
                error: function (error) {
                  alert("error!");
                }
              });
            }
    );
  }
</script>
</body>
</html>
